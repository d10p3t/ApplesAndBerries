extends layout

block content
	title CV View
	.ui.middle.center.aligned.grid.stackable.doubling
		// Title
		.seven.wide.column.row#menu-row(style="margin-top:7vh; margin-bottom:0;")
			.section-title.ui.center.aligned.segment(style="margin-bottom:0;")
				h1 Check Voucher
		// buttons
		.row.button-row
			button#add-CV-button.ui.button(onclick="location.replace('/checkvoucher')") ADD
			.ui.button EDIT
			.ui.button#delete-checkVoucher-button DELETE
		// Table Proper
		.row
			.ui.container.view-table
				table#check-voucher-view-table.ui.table.fluid.selectable.sortable
					thead
						tr
							th
								.ui.master.checkbox
									input(type="checkbox", name="cv-master-checkbox")
									label
							th.collapsing AN#
							th.two.wide Issued By
							th.three.wide Name
							th.two.wide Date
							th Particulars
							th.two.wide Amount
					tbody
						for item in transactions
							tr
								td
									.ui.checkbox
										input(type="checkbox", name="cv-checkbox", data-an=item.adviceNumber)
										label
								td= item.adviceNumber
								td= item.issuedBy
								td= item.name
								td= item.date
								td= item.particulars
								td= item.amount


		// PRINT BUTTON
		.fifteen.wide.column(style="padding: 0 1em 1em 1em !important;")
			button.ui.button.right.floated.column#print-check-voucher-button Print


	script(type='text/javascript' src='javascripts/sorttable.js')
	script(type='text/javascript' src='javascripts/scripts.js')
	script(type='text/javascript').
		var sendAjax = function(values, link, success_function){
			return $.ajax({
				url: link,
				type: "POST",
				datatype: "json",
				data: JSON.stringify(values),
				contentType: "application/json; charset=utf-8",
				cache: "false",
				timeout: "10000",
				complete: function(){
					console.log('process complete')
				},
				success: success_function(),
				error: function(){
					console.log('process error')
				},
			});
		}

		$('#delete-checkVoucher-button').click(function(){
			var checkboxes = $('.ui.checkbox input:checked').map(function(i, element){
				return $(element).data('an');
			});
			//- console.log(checkboxes);
			sendAjax(checkboxes, '/deleteCheckvoucher', function(){
				console.log('process success');
				window.location.reload();
			})
			.then((data) => {
				console.log(data);
				console.log('process success');
				window.location.reload();
			});
		});